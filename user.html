<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Temi Quiz</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body { padding: 20px; }
        #ratingContainer button {
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="quizContainer" class="p-4 border rounded">
            <h3 id="questionText"></h3>
            <div id="optionsContainer"></div>
            <div id="ratingContainer" class="d-flex flex-wrap"></div>
        </div>
        <div id="completionMessage" class="alert alert-success mt-4" style="display:none;">
            Thank you! You have completed the quiz.
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzP-aNrz7v0k1c6itgfNDPccBRWhEdI_w7Yz5vDlOk5UGwaPGtx7HKxMIV1W6sSbbXU/exec'; // Set to your deployed Apps Script Web App

        let questions = [];
        let currentIndex = 0;

        function fetchQuestions() {
            fetch(API_URL)
                .then(response => response.json())
                .then(data => {
                    questions = data.filter(q => q.enabled === true || q.enabled === 'TRUE');
                    currentIndex = 0;
                    if (questions.length > 0) {
                        showQuestion();
                    } else {
                        document.getElementById('quizContainer').style.display = 'none';
                        document.getElementById('completionMessage').textContent = 'No questions available.';
                        document.getElementById('completionMessage').style.display = 'block';
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert('Failed to load questions. Check API URL.');
                });
        }

        function showQuestion() {
            if (currentIndex >= questions.length) {
                document.getElementById('quizContainer').style.display = 'none';
                document.getElementById('completionMessage').style.display = 'block';
                return;
            }
            const q = questions[currentIndex];
            document.getElementById('questionText').textContent = q.question;
            const optionsContainer = document.getElementById('optionsContainer');
            const ratingContainer = document.getElementById('ratingContainer');
            optionsContainer.innerHTML = '';
            ratingContainer.innerHTML = '';

            // play audio if provided
            if (q.audioURL) {
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = q.audioURL;
                audioPlayer.play();
            }

            if (q.type === 'mcq') {
                const options = [q.option1, q.option2, q.option3, q.option4];
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'btn btn-primary m-1';
                    btn.textContent = opt;
                    btn.addEventListener('click', () => {
                        saveAnswer(q.id, opt);
                    });
                    optionsContainer.appendChild(btn);
                });
            } else if (q.type === 'rating') {
                for (let i = 1; i <= 10; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'btn btn-primary m-1';
                    btn.textContent = i;
                    btn.addEventListener('click', () => {
                        saveAnswer(q.id, i);
                    });
                    ratingContainer.appendChild(btn);
                }
            }
        }

        function saveAnswer(questionId, answer) {
            const params = new URLSearchParams();
            params.append('action', 'saveResponse');
            params.append('questionId', questionId);
            params.append('answer', answer);

            fetch(API_URL, {
                method: 'POST',
                body: params
            })
            .then(response => response.text())
            .then(result => {
                currentIndex++;
                showQuestion();
            })
            .catch(err => {
                console.error(err);
                alert('Failed to save response.');
            });
        }

        // start
        fetchQuestions();
    </script>
</body>
</html>
