<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Temi Quiz</title>

<style>
html,body{
  margin:0;padding:0;
  width:100%;height:100%;
  font-family:Arial, sans-serif;
  background:#f0f4ff;
  overflow:hidden;
}

/* SPLASH SCREEN */
#splash {
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:99;
}
#splash img{
  width:50%;
  animation:fade 3s infinite;
}
@keyframes fade{
  0%{opacity:0;} 
  50%{opacity:1;} 
  100%{opacity:0;}
}

/* QUIZ SCREEN */
#quizContainer{
  display:none;
  width:100%;height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:20px;
}

#question{
  font-size:2.8rem;
  font-weight:bold;
  margin-bottom:40px;
  padding:0 20px;
}

.answer{
  width:85%;
  padding:28px;
  margin:12px 0;
  font-size:2rem;
  border:none;
  border-radius:22px;
  background:linear-gradient(135deg,#5a8dee,#8868ff);
  color:white;
}

#rating button{
  width:110px;height:110px;
  border-radius:50%;
  font-size:2rem;
  margin:10px;
  background:#00aaff;
  color:white;
  border:none;
}

#speak{
  font-size:3rem;
  background:none;
  border:none;
  margin-bottom:20px;
}

/* NAV BUTTONS */
.navbtn{
  position:fixed;
  bottom:25px;
  padding:25px;
  font-size:2rem;
  border:none;
  border-radius:15px;
  background:#444;
  color:white;
}
#prev { left:25px; }
#next { right:25px; }

</style>
</head>

<body>

<!-- SPLASH SCREEN -->
<div id="splash" onclick="startQuiz()">
  <img src="assets/allbotix-logo.png">
</div>

<!-- QUIZ SCREEN -->
<div id="quizContainer">

  <button id="speak">ðŸ”Š</button>

  <div id="question">Loading...</div>

  <div id="options"></div>
  <div id="rating" style="display:none;"></div>

  <!-- Navigation Buttons -->
  <button id="prev" class="navbtn">â¬… Prev</button>
  <button id="next" class="navbtn">Next âž¡</button>

</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzVgZWYScmH7II7TK4rg3-tbZFW-sEdhFMqDUXCQZiUhc8KkW_5xzzVs6QlqprPoIlC/exec";

let questions=[];
let index=0;
let quizStarted=false;

/****************************
  START QUIZ (touch splash)
*****************************/
function startQuiz(){
  document.getElementById("splash").style.display="none";
  document.getElementById("quizContainer").style.display="flex";
  quizStarted=true;
  loadQuestions();
}

/****************************
  LOAD QUESTIONS FROM SHEET
*****************************/
function loadQuestions(){
  fetch(API_URL)
    .then(r=>r.json())
    .then(data=>{
      questions=data.filter(q=>q.enabled==="TRUE" || q.enabled===true);
      showQ();
    });
}

/****************************
  DISPLAY QUESTION
*****************************/
function showQ(){
  if(!questions.length) return;

  const q=questions[index];
  document.getElementById("question").innerText=q.question;

  const opts=document.getElementById("options");
  const rating=document.getElementById("rating");

  opts.innerHTML="";
  rating.innerHTML="";
  rating.style.display="none";

  if(q.type==="mcq"){
    [q.option1,q.option2,q.option3,q.option4].forEach(opt=>{
      let btn=document.createElement("button");
      btn.className="answer";
      btn.innerText=opt;
      btn.onclick=()=>saveAnswer(opt);
      opts.appendChild(btn);
    });
  } else {
    rating.style.display="block";
    for(let i=1;i<=10;i++){
      let b=document.createElement("button");
      b.innerText=i;
      b.onclick=()=>saveAnswer(i);
      rating.appendChild(b);
    }
  }

  speakNow();
}

/****************************
  SPEAK QUESTION + OPTIONS
*****************************/
document.getElementById("speak").onclick = speakNow;

function speakNow(){
  const q=questions[index];
  let msg=q.question+". ";

  if(q.type==="mcq"){
    msg += "Options are: "+q.option1+", "+q.option2+", "+q.option3+", "+q.option4;
  } else {
    msg += "Please rate from 1 to 10.";
  }

  speechSynthesis.cancel();
  speechSynthesis.speak(new SpeechSynthesisUtterance(msg));
}

/****************************
  SAVE ANSWER
*****************************/
function saveAnswer(ans){
  fetch(API_URL,{
    method:"POST",
    body:new URLSearchParams({
      action:"saveResponse",
      questionId:questions[index].id,
      answer:ans
    })
  });

  if(index<questions.length-1){
    index++;
    showQ();
  } else {
    showComplete();
  }
}

/****************************
  NEXT / PREV BUTTONS
*****************************/
document.getElementById("next").onclick=function(){
  if(index<questions.length-1){index++;showQ();}
};
document.getElementById("prev").onclick=function(){
  if(index>0){index--;showQ();}
};

/****************************
  QUIZ COMPLETE â†’ RETURN TO SPLASH
*****************************/
function showComplete(){
  document.body.innerHTML=
    "<h1 style='font-size:3rem;text-align:center;margin-top:40%;'>Thank You ðŸŽ‰</h1>";

  setTimeout(()=>{ window.location.href="splash.html"; }, 10000);
}

</script>

</body>
</html>
