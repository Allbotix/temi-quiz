<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Temi Quiz</title>

<style>
html,body{
  margin:0;padding:0;
  width:100%;height:100%;
  font-family:Arial, sans-serif;
  background:#f0f4ff;
  overflow:hidden;
}
#container{
  width:100%;height:100%;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  text-align:center;padding:20px;
}
#question{
  font-size:3rem;
  font-weight:bold;
  margin-bottom:30px;
}
.answer{
  width:85%;
  padding:25px;
  margin:12px 0;
  font-size:2rem;
  border:none;
  border-radius:20px;
  background:linear-gradient(135deg,#5a8dee,#8868ff);
  color:white;
}
.navbtn{
  padding:20px 28px;
  border:none;
  font-size:2rem;
  margin:10px;
  border-radius:12px;
}
#speak{
  font-size:3.5rem;
  background:none;border:none;
  margin-bottom:10px;
}
#rating button{
  width:120px;height:120px;
  border-radius:50%;
  font-size:2rem;
  margin:10px;
  background:#00aaff;
  color:white;
  border:none;
}
</style>
</head>

<body>
<div id="container">

  <button id="speak">ðŸ”Š</button>

  <div id="question">Loading...</div>

  <div id="options"></div>

  <div id="rating" style="display:none;"></div>

  <div>
    <button class="navbtn" id="prev">â¬… Prev</button>
    <button class="navbtn" id="next">Next âž¡</button>
  </div>

</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzVgZWYScmH7II7TK4rg3-tbZFW-sEdhFMqDUXCQZiUhc8KkW_5xzzVs6QlqprPoIlC/exec";

let questions=[];
let index=0;
let idleTimer=null;

// ------------------------------
// Load Questions
// ------------------------------
fetch(API_URL)
  .then(r=>r.json())
  .then(data=>{
    questions=data.filter(q=>q.enabled==="TRUE" || q.enabled===true);
    showQ();
  });

// ------------------------------
// Show Question
// ------------------------------
function showQ(){
  if(!questions.length) return;

  const q=questions[index];
  document.getElementById("question").innerText=q.question;

  const optDiv=document.getElementById("options");
  const rateDiv=document.getElementById("rating");
  optDiv.innerHTML="";
  rateDiv.innerHTML="";
  rateDiv.style.display="none";

  if(q.type==="mcq"){
    [q.option1,q.option2,q.option3,q.option4].forEach(opt=>{
      let btn=document.createElement("button");
      btn.className="answer";
      btn.innerText=opt;
      btn.onclick=()=>saveAnswer(opt);
      optDiv.appendChild(btn);
    });
  } else {
    rateDiv.style.display="block";
    for(let i=1;i<=10;i++){
      let b=document.createElement("button");
      b.innerText=i;
      b.onclick=()=>saveAnswer(i);
      rateDiv.appendChild(b);
    }
  }

  speakNow();
  resetIdleTimer();
}

// ------------------------------
// Save Answer
// ------------------------------
function saveAnswer(ans){
  fetch(API_URL,{
    method:"POST",
    body:new URLSearchParams({
      action:"saveResponse",
      questionId:questions[index].id,
      answer:ans
    })
  });

  if(index<questions.length-1){
    index++;
    showQ();
  } else {
    document.body.innerHTML="<h1 style='font-size:3rem;text-align:center;margin-top:40%;'>Thank you! ðŸŽ‰</h1>";
  }
}

// ------------------------------
// Next & Prev
// ------------------------------
document.getElementById("next").onclick=function(){
  if(index<questions.length-1){
    index++;showQ();
  }
};
document.getElementById("prev").onclick=function(){
  if(index>0){
    index--;showQ();
  }
};

// ------------------------------
// Speak Question
// ------------------------------
document.getElementById("speak").onclick=speakNow;

function speakNow(){
  const q=questions[index];
  let msg=q.question + ". ";
  if(q.type==="mcq"){
    msg+="Options are: "+q.option1+", "+q.option2+", "+q.option3+", "+q.option4;
  } else {
    msg+="Please rate from 1 to 10.";
  }
  speechSynthesis.speak(new SpeechSynthesisUtterance(msg));
}

// ------------------------------
// Idle Timer â†’ return to splash
// ------------------------------
function resetIdleTimer(){
  clearTimeout(idleTimer);
  idleTimer=setTimeout(()=>{
    window.location.href="splash.html";
  }, 5*60*1000); // 5 minutes
}

document.body.addEventListener("click", resetIdleTimer);
document.body.addEventListener("touchstart", resetIdleTimer);
</script>

</body>
</html>
