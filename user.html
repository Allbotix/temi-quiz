<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Temi Quiz</title>

<style>
/* GENERAL PAGE STYLES */
html,body{
  margin:0;padding:0;
  width:100%;height:100%;
  font-family:Arial, sans-serif;
  background:#f0f4ff;
  overflow:hidden;
}

/* SPLASH SCREEN */
#splash {
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:black;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:9999;
}

#splashText{
  font-size:4rem;
  font-weight:bold;
  letter-spacing:4px;
  animation:fade 3s infinite;
}

@keyframes fade{
  0%{opacity:0;} 
  50%{opacity:1;} 
  100%{opacity:0;}
}

/* QUIZ SCREEN */
#quizContainer{
  display:none;
  width:100%;height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:20px;
}

#question{
  font-size:2.7rem;
  font-weight:bold;
  margin-bottom:40px;
  padding:0 25px;
}

.answer{
  width:85%;
  padding:28px;
  margin:12px 0;
  font-size:2rem;
  border:none;
  border-radius:20px;
  background:linear-gradient(135deg,#5a8dee,#8868ff);
  color:white;
}

#rating button{
  width:110px;height:110px;
  border-radius:50%;
  font-size:2rem;
  margin:10px;
  background:#00aaff;
  color:white;
  border:none;
}

#speak{
  font-size:3.2rem;
  background:none;
  border:none;
  margin-bottom:20px;
}

/* NAVIGATION BUTTONS */
.navbtn{
  position:fixed;
  bottom:25px;
  padding:22px 30px;
  font-size:2rem;
  border:none;
  border-radius:18px;
  background:#333;
  color:white;
}
#prev { left:25px; }
#next { right:25px; }

</style>
</head>

<body>

<!-- SPLASH SCREEN -->
<div id="splash" onclick="startQuiz()">
  <div id="splashText">Allbotix</div>
</div>

<!-- QUIZ SCREEN -->
<div id="quizContainer">

  <button id="speak">ðŸ”Š</button>

  <div id="question">Loading...</div>

  <div id="options"></div>
  <div id="rating" style="display:none;"></div>

  <!-- Navigation Buttons -->
  <button id="prev" class="navbtn">â¬… Prev</button>
  <button id="next" class="navbtn">Next âž¡</button>

</div>

<script>
/************************************
   CONFIG
*************************************/
const API_URL = "YOUR_WEBAPP_URL"; // <<< PUT YOUR WEB APP URL HERE

let questions=[];
let index=0;

/************************************
   START QUIZ
*************************************/
function startQuiz(){
  document.getElementById("splash").style.display="none";
  document.getElementById("quizContainer").style.display="flex";
  loadQuestions();
}

/************************************
   LOAD QUESTIONS FROM GOOGLE SHEET
*************************************/
function loadQuestions(){
  fetch(API_URL)
    .then(r=>r.json())
    .then(data=>{
      questions=data.filter(q=>q.enabled==="TRUE" || q.enabled===true);
      showQ();
    });
}

/************************************
   SHOW QUESTION
*************************************/
function showQ(){
  if(!questions.length) return;

  const q=questions[index];
  document.getElementById("question").innerText = q.question;

  const opts=document.getElementById("options");
  const rating=document.getElementById("rating");

  opts.innerHTML="";
  rating.innerHTML="";
  rating.style.display="none";

  if(q.type==="mcq"){
    [q.option1, q.option2, q.option3, q.option4].forEach(opt=>{
      let b=document.createElement("button");
      b.className="answer";
      b.innerText=opt;
      b.onclick=()=>saveAnswer(opt);
      opts.appendChild(b);
    });
  } else {
    rating.style.display="block";
    for(let i=1;i<=10;i++){
      let b=document.createElement("button");
      b.innerText=i;
      b.onclick=()=>saveAnswer(i);
      rating.appendChild(b);
    }
  }

  speakQuestion();
}

/************************************
   TEXT TO SPEECH
*************************************/
document.getElementById("speak").onclick = speakQuestion;

function speakQuestion(){
  const q=questions[index];
  let text=q.question + ". ";

  if(q.type==="mcq"){
    text+="Options are: "+q.option1+", "+q.option2+", "+q.option3+", "+q.option4;
  } else {
    text+="Please rate from 1 to 10.";
  }

  speechSynthesis.cancel();
  speechSynthesis.speak(new SpeechSynthesisUtterance(text));
}

/************************************
   SAVE ANSWER
*************************************/
function saveAnswer(ans){
  fetch(API_URL,{
    method:"POST",
    body:new URLSearchParams({
      action:"saveResponse",
      questionId:questions[index].id,
      answer:ans
    })
  });

  if(index<questions.length-1){
    index++;
    showQ();
  } else {
    showComplete();
  }
}

/************************************
   NEXT / PREVIOUS BUTTONS
*************************************/
document.getElementById("next").onclick=function(){
  if(index<questions.length-1){
    index++;showQ();
  }
};
document.getElementById("prev").onclick=function(){
  if(index>0){
    index--;showQ();
  }
};

/************************************
   QUIZ COMPLETE (10 sec â†’ splash)
*************************************/
function showComplete(){
  document.body.innerHTML =
    "<h1 style='font-size:3rem; text-align:center; margin-top:40%;'>Thank You ðŸŽ‰</h1>";

  setTimeout(()=>{ window.location.href="user.html"; }, 10000);
}

</script>

</body>
</html>
